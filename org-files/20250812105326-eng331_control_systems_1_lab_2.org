:PROPERTIES:
:ID:       536ba461-384b-4879-9b5e-8155ff6cae59
:END:
#+title: ENG331 - Control Systems 1 - Lab 2
#+date: [2025-08-12 Tue 10:53]
#+AUTHOR: Baley Eccles - 652137 - Matthew Hocking - 659747 - Tyler Robards – 651790
#+FILETAGS: :Assignment:UTAS:2025:
#+STARTUP: latexpreview
#+LATEX_HEADER: \usepackage[a4paper, margin=2cm]{geometry}
#+LATEX_HEADER_EXTRA: \usepackage{minted}
#+LATEX_HEADER_EXTRA: \usepackage{fontspec}
#+LATEX_HEADER_EXTRA: \setmonofont{Iosevka}
#+LATEX_HEADER_EXTRA: \setminted{fontsize=\small, frame=single, breaklines=true}
#+LATEX_HEADER_EXTRA: \usemintedstyle{emacs}
#+LATEX_HEADER_EXTRA: \usepackage{float}
#+LATEX_HEADER_EXTRA: \setlength{\parindent}{0pt}
#+LATEX_HEADER_EXTRA: \setlength{\parskip}{1em}

\newpage
* System Familiarisation and Calibration
** Calibration
#+ATTR_LATEX: :placement [H]
#+ATTR_LATEX: :align |c|c|c|c|
#+CAPTION: Measured Tank Heights \label{tab:T0}
|--------------------------------+------------------------------+--------------------------------+------------------------------|
| Actual Tank 1 Height $h_{1,i}$ | Uncalibrated value $v_{1,i}$ | Actual tank 2 height $h_{2,i}$ | Uncalibrated value $v_{2,i}$ |
|--------------------------------+------------------------------+--------------------------------+------------------------------|
|                              4 |                           80 |                            8.5 |                          130 |
|--------------------------------+------------------------------+--------------------------------+------------------------------|
|                           11.5 |                          220 |                             22 |                          540 |
|--------------------------------+------------------------------+--------------------------------+------------------------------|

Solving the following system of equations for Tank 1:
\[\begin{cases}
4  &= 80\cdot\textrm{scale} + \textrm{offset} \\
11.5  &= 220\cdot\textrm{scale} + \textrm{offset}
\end{cases}\]
We get $\textrm{scale} = 0.05357$ and $\textrm{offset} = -0.2857$

Solving the following system of equations for Tank 2:
\[\begin{cases}
8.5  &= 130\cdot\textrm{scale} + \textrm{offset} \\
22  &= 540\cdot\textrm{scale} + \textrm{offset}
\end{cases}\]
We get $\textrm{scale} = 0.03293$ and $\textrm{offset} = 4.22$

** Tank Parameters
The bottom nozzle diameter (Tank 2) was recorded to be 4mm. Whereas the top nozzle diameter (Tank 1) was recorded to be 5mm. The diameter of Tank 2 was recorded to be 4.5cm, likewise the diameter of Tank 1 was also recorded to be 4.5cm.

* System Identification

** Pump Gain
If we set the pump voltage to $V_p = 10V$ it takes $t = 11s$ to fill the tank to $h = 20cm$. This data allows us to calculate the pump gain.
\begin{align*}
\textrm{Vol} &= \pi r^2 h \\
\textrm{Vol} &= \pi (4.5/2)^2 \cdot 20 \\
\textrm{Vol} &= 0.000318 m^3 \\
&\\
q_0 &= \frac{\textrm{Vol}}{t} \\
q_0 &= \frac{0.000318}{11} \\
q_0 &= 0.000029 m^3/s \\
&\\
\textrm{Pump Gain} &= \frac{q_0}{V_p} \\
\textrm{Pump Gain} &= \frac{0.000029}{10} \\
\textrm{Pump Gain} &= 0.000003
\end{align*}

If we set the pump voltage to $V_p = 5V$ it takes $t = 17.41s$ to fill the tank to $h = 20cm$. Once again, this data allows us to calculate the pump gain.
\begin{align*}
\textrm{Vol} &= \pi r^2 h \\
\textrm{Vol} &= \pi (4.5/2)^2\cdot 20 \\
\textrm{Vol} &= 0.000318 m^3 \\
&\\
q_0 &= \frac{\textrm{Vol}}{t} \\
q_0 &= \frac{0.000318}{17.41s} \\
q_0 &= 0.000018 m^3/s \\
&\\
\textrm{Pump Gain} &= \frac{q_0}{V_p} \\
\textrm{Pump Gain} &= \frac{0.000018}{5} \\
\textrm{Pump Gain} &= 0.000004 
\end{align*}

/How well does our assumption of a linear relationship between output flow and pump voltage hold in this case?/

At two different voltages the pump gain changes, this means that it is non-linear. With a double in voltage the pump gain changes by 25%, in the future analysis we will only be changing by one volt, so the linear approximation is valid.

/Will this have a significant effect on the accuracy of our theoretical model? Why/why not?/

This will not effect our theoretical models too much, the amount at which the pump gain changes with voltage is minimal.

** Discharge Coefficient
During the lab there were complications in calculating $C_d$. For the Simulink models where it was required a value was chosen that fit the data well. 

** Tank Model
#+ATTR_LATEX: :placement [H]
#+ATTR_LATEX: :align |c|c|c|c|c|
#+CAPTION: Experimental Configuration #1 Data \label{tab:T1}
|-------------------------+--------------+------------------+-------------+----------------------------|
| Operating point (cm, V) | Step (Volts) | Final Value (cm) | Gain (cm/V) | 2% Settling Time (seconds) |
|-------------------------+--------------+------------------+-------------+----------------------------|
| 4.2, 5                  | $-1V$        |             2.21 |        2.03 |                       15.1 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| 4.2, 5                  | $+1V$        |             6.12 |        1.89 |                       16.2 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| 6.7, 7                  | $-1V$        |             5.71 |        1.11 |                       11.1 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| 6.7, 7                  | $+1V$        |             7.76 |        1.04 |                       10.9 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| 8.5, 9                  | $-1V$        |             7.68 |        0.90 |                       10.2 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| 8.5, 9                  | $+1V$        |             9.53 |        1.44 |                       23.0 |
|-------------------------+--------------+------------------+-------------+----------------------------|

#+ATTR_LATEX: :placement [H]
#+CAPTION: Operating Point 1 Experimental Plot \label{fig:F1}
[[./ENG331_Lab_2_OP_1.png]]

#+ATTR_LATEX: :placement [H]
#+CAPTION: Operating Point 2 Experimental Plot \label{fig:F2}
[[./ENG331_Lab_2_OP_2.png]]

#+ATTR_LATEX: :placement [H]
#+CAPTION: Operating Point 3 Experimental Plot \label{fig:F3}
[[./ENG331_Lab_2_OP_3.png]]

#+ATTR_LATEX: :placement [H]
#+ATTR_LATEX: :align |c|c|c|c|c|
#+CAPTION: Non-Linear Configuration #1 Data \label{tab:T2}
|-------------------------+--------------+------------------+-------------+----------------------------|
| Operating point (cm, V) | Step (Volts) | Final Value (cm) | Gain (cm/V) | 2% Settling Time (seconds) |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (3.00, 5)               | $-1V$        |             1.95 |        1.05 |                         22 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (3.00, 5)               | $+1V$        |             4.25 |        1.25 |                         24 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (5.88, 7)               | $-1V$        |             4.41 |        1.47 |                         26 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (5.88, 7)               | $+1V$        |             7.53 |        1.64 |                         26 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (9.73, 9)               | $-1V$        |             7.87 |        1.85 |                         28 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (9.73, 9)               | $+1V$        |             11.2 |        1.99 |                         28 |
|-------------------------+--------------+------------------+-------------+----------------------------|

#+ATTR_LATEX: :placement [H]
#+ATTR_LATEX: :align |c|c|c|c|c|
#+CAPTION: Linear Configuration #1 Data \label{tab:T3}
|-------------------------+--------------+------------------+-------------+----------------------------|
| Operating point (cm, V) | Step (Volts) | Final Value (cm) | Gain (cm/V) | 2% Settling Time (seconds) |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (4.94, 5)               | $-1V$        |             3.98 |       0.966 |                       12.0 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (4.94, 5)               | $+1V$        |             5.91 |       0.966 |                       12.0 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (6.88, 7)               | $-1V$        |             5.92 |       0.962 |                       7.89 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (6.88, 7)               | $+1V$        |             7.84 |       0.962 |                       7.94 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (8.82, 9)               | $-1V$        |             7.86 |       0.965 |                       9.24 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (8.82, 9)               | $+1V$        |             9.79 |       0.965 |                       9.31 |
|-------------------------+--------------+------------------+-------------+----------------------------|


/a) Did you observe a difference in response for positive or negative input perturbations? Can you explain this?/

There were differences between inputting positive compared to negative steps. This is because this system is dependent on the state of the system, the pressure in the tank will increase for positive steps and decrease for negative steps. Hence we would expect to see positive inputs to fill Tank 1 slower, this can be seen in Table \ref{tab:T1}, \ref{tab:T2} and \ref{tab:T3} each of the tables have data that have different settling time for positive compared to negative steps for the same operating point.


/b) Explain any differences between nonlinear model and experimental?/

There are a lot of differences between experimental and the non-linear model, this is mainly because of noise in the measurements. However some notable differences are the 2% settling time and the operating point height. The 2% settling time is consistently quicker in the real world system then the theoretical system, this could be because of various reasons, but it implies that the pump is stronger in reality than the simulation, this could be due to guessing $C_d$. The operating point varies a fair bit from the theoretical data, the this is probably because of inaccuracies in measurement/calibration.

/c) Would you expect the linearised model to fit the data worse if the step size was increased?/

It is expected that the linearised model would perform worse with larger step sizes. This is because the linearised model works around a operating point, the further away from that point the less accurate the linear approximation becomes.

** Coupled Tank Model
#+ATTR_LATEX: :placement [H]
#+ATTR_LATEX: :align |c|c|c|c|c|
#+CAPTION: Experimental Configuration #3 Data \label{tab:T4}
|-------------------------+--------------+------------------+-------------+----------------------------|
| Operating point (cm, V) | Step (Volts) | Final Value (cm) | Gain (cm/V) | 2% Settling Time (seconds) |
|-------------------------+--------------+------------------+-------------+----------------------------|
| 9.0, 5                  | $-1V$        |           6.8791 |      2.4121 |                       23.4 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| 9.0, 5                  | $+1V$        |          11.2303 |      1.8601 |                       25.4 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| 14.5, 7                 | $-1V$        |          11.9198 |      2.7390 |                       17.9 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| 14.5, 7                 | $+1V$        |          16.6517 |      2.3749 |                       15.6 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| 19.5, 9                 | $-1V$        |          17.7358 |      2.4684 |                       13.3 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| 19.5, 9                 | $+1V$        |          21.3884 |      1.4476 |                       15.2 |
|-------------------------+--------------+------------------+-------------+----------------------------|

#+ATTR_LATEX: :placement [H]
#+ATTR_LATEX: :align |c|c|c|c|c|
#+CAPTION: Non-Linear Configuration #3 Data \label{tab:T5}
|-------------------------+--------------+------------------+-------------+----------------------------|
| Operating point (cm, V) | Step (Volts) | Final Value (cm) | Gain (cm/V) | 2% Settling Time (seconds) |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (7.33, 5)               | $-1V$        |            5.171 |        2.16 |                         38 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (7.33, 5)               | $+1V$        |            9.645 |        2.31 |                         40 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (14.3, 7)               | $-1V$        |            11.82 |        2.55 |                         40 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (14.3, 7)               | $+1V$        |            16.94 |        2.56 |                         40 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (23.7, 9)               | $-1V$        |            21.06 |        2.69 |                         40 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (23.7, 9)               | $+1V$        |            26.38 |        2.61 |                         38 |
|-------------------------+--------------+------------------+-------------+----------------------------|

#+ATTR_LATEX: :placement [H]
#+ATTR_LATEX: :align |c|c|c|c|c|
#+CAPTION: Linear Configuration #3 Data \label{tab:T6}
|-------------------------+--------------+------------------+-------------+----------------------------|
| Operating point (cm, V) | Step (Volts) | Final Value (cm) | Gain (cm/V) | 2% Settling Time (seconds) |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (10.8, 5)               | $-1V$        |              8.8 |        2.77 |                       15.7 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (10.9, 5)               | $+1V$        |             10.9 |        2.77 |                       15.7 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (15.2, 7)               | $-1V$        |             13.1 |        2.12 |                       15.7 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (15.2, 7)               | $+1V$        |             17.3 |        2.09 |                       11.8 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (19.5, 9)               | $-1V$        |             17.4 |        2.11 |                       16.0 |
|-------------------------+--------------+------------------+-------------+----------------------------|
| (19.5, 9)               | $+1V$        |             21.6 |        2.08 |                       12.0 |
|-------------------------+--------------+------------------+-------------+----------------------------|

/a) Did you observe a difference in response for positive or negative input perturbations? Can you explain this?/

It is still expected that there would be differences in positive and negative step inputs. This is still because the system depends on its state, the outflow of the tank depends on the height in the tank. However, for Tank 2 it is harder to see than Tank 1 because Tank 1 is flowing into Tank 2, leading to a more consistent outflow from Tank 1. 

/b) Explain any differences between nonlinear model and experimental?/

The 2% settling time is consistently quicker in the experimental model when compared with the non-linear model. This si

/c) Would you expect the linearised model to fit the data worse if the step size was increased?/

Same as Tank 1, the linear approximation is dependent on the operating point. The further away from the operating point we go the less accurate the approximation will become.

/d) Is it possible for this system to exhibit overshoot?/

This system is first order, which only has one pole. This means that it is impossible to overshoot, however the real world system may exhibit inconsistencies with the theoretical system, making it a higher order system. So in the real world it may have small amounts of overshoot, but in theory it is not possible.


* Model Estimation
** Second Order Model Approximations
*** Using measured step response metrics
/Selected operating point initial and final value for $V_P(t)$:/

Using operating point 2 (7V).

/Estimated gain $K$, damping factor $\zeta$, and natural frequency $\omega_n$:/

From visual inspection we can see there is no overshoot in the tank level so we can assume the system is overdamped($1<\zeta$).
Use the prototype second order transfer function,
\[T(s)=\dfrac{K\omega_n^2}{s^2+2\zeta\omega_ns+\omega_n^2}\]
Start by estimating the gain using the change in tank 2 level after a unit step.
\[K=\dfrac{\Delta y}{\Delta u}\]
Where $\Delta u$ is the voltage step change and $\Delta y$ is the tank 2 output change,
Check multiple step changes to confirm the gain estimation.

\[K_1=\dfrac{11.43-14.89}{6-7}=3.46\]
\[K_2=\dfrac{17.37-13.70}{8-7}=3.67\]
The is some error in these calculations due to the noise in the output signl $h_2$. Using this estimate the gain to be $K=3.5$.

Using the results from the Table \ref{tab:T4} as well as visual inspection from the plot in Figure \ref{fig:F2} we can estimate the 2% settling time to be 17s. 
Using the settling time and the previosly estimated damping ratio we can find $\omega_n$. 
\[\omega_n\approx\dfrac{4}{\zeta T_s}=0.196\:rad/s\]


/Estimated prototype second order transfer function:/

\[T(s)=\dfrac{0.1344}{s^2+0.4704s+0.0384}\]

This being compared to the other systems can be seen in Figure \ref{fig:F4}.

*** Using MATLAB’s Control Systems Toolbox system identification app
/Selected operating point initial and final value for $V_P(t)$:/

Using operating point 3 (9V).

/Estimated gain $K$, damping factor $\zeta$, and natural frequency $\omega_n$:/

$K=0.1520$,$\zeta=0.87$,$\omega_n=0.0741\:rad/s$

/Estimated prototype second order transfer function:/

\[T(s)=\dfrac{0.01126}{s^2+0.129s+0.005497}\]

/Comment on the differences between the empirical models, how well this fit the data, and any differences between the empirical estimation and that developed from theory./

Looking at Figure \ref{fig:F4}, it can be seen that both estimations fit the empirical data relatively well. Both estimations follow the shape of the actual response. The theoretical estimation appears to have a smaller rise time than the actual response aswell as a small DC offset, however it follows the same general shape. The MATLAB estimation rise time appears to be closer to that of the actual response. There is still some small DC offset noticeable but it is smaller than the theoretical estimation.

#+ATTR_LATEX: :placement [H]
#+CAPTION: Second Order Estimations vs Empirical Models \label{fig:F4}
[[./ENG331_Lab_2_Comparison.png]]

** Model Application Comparison

/Selected operating point initial and final value for $V_p(t)$:/

The 9V operating point was selected (operating point 3).

/How well do your empirical models generalise to different operating points or initial conditions?/

Referring to Figure \ref{fig:F5}, it can be seen that the general shape of both estimations fit to the different operating points well. The MATLAB estimations fits very well to this 9V operating point with no noticable offset present. The shape of the theoretical esitmation response matches the actual response well but there is a small DC offset present. This is likely due to the gain being slightly off.

#+ATTR_LATEX: :placement [H]
#+CAPTION: Second Order Estimations vs Operating Point 3 \label{fig:F5}
[[./ENG331_Lab_2_Comparison_OP_3.png]]


