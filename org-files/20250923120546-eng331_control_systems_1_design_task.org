:PROPERTIES:
:ID:       30e0f262-edfa-442f-8e1c-7abf03e3ed19
:END:
#+title: ENG331 - Control Systems 1 - Design Task
#+date: [2025-09-23 Tue 12:05]
#+AUTHOR: Baley Eccles - 652137
#+STARTUP: latexpreview

* ENG331 - Control Systems 1 - Design Task
|--------------------------------+------------------------------+--------------------------------+------------------------------|
| Actual Tank 1 Height $h_{1,i}$ | Uncalibrated value $v_{1,i}$ | Actual tank 2 height $h_{2,i}$ | Uncalibrated value $v_{2,i}$ |
|--------------------------------+------------------------------+--------------------------------+------------------------------|
|                             13 |                          255 |                           26.5 |                          548 |
|--------------------------------+------------------------------+--------------------------------+------------------------------|
|                            7.5 |                          135 |                           15.5 |                          306 |
|--------------------------------+------------------------------+--------------------------------+------------------------------|
#+BEGIN_SRC octave :exports code :results output :session Q1
clc
clear
close all

pkg load symbolic

syms s1 o1 s2 o2
h_1_1 = 13;
v_1_1 = 255;
h_2_1 = 26.5;
v_2_1 = 548;

h_1_2 = 7.5;
v_1_2 = 135;
h_2_2 = 15.5;
v_2_2 = 306;

equ1 = h_1_1 == v_1_1*s1 + o1;
equ2 = h_1_2 == v_1_2*s1 + o1;
[o1, s1] = solve(equ1, equ2)
offset1 = double(o1)
scale1 = double(s1)

equ3 = h_2_1 == v_2_1*s2 + o2;
equ4 = h_2_2 == v_2_2*s2 + o2;
[o2, s2] = solve(equ3, equ4);
offset2 = double(o2)
scale2 = double(s2)
#+END_SRC

#+RESULTS:
#+begin_example
warning: passing floating-point values to sym is dangerous, see "help sym"
warning: called from
    double_to_sym_heuristic at line 50 column 7
    sym at line 384 column 13
    eq at line 93 column 5
o1 = (sym)

  21
  ──
  16

s1 = (sym)

  11 
  ───
  240
offset1 = 1.3125
scale1 = 0.045833
warning: passing floating-point values to sym is dangerous, see "help sym"
warning: called from
    double_to_sym_heuristic at line 50 column 7
    sym at line 384 column 13
    eq at line 93 column 5
warning: passing floating-point values to sym is dangerous, see "help sym"
warning: called from
    double_to_sym_heuristic at line 50 column 7
    sym at line 384 column 13
    eq at line 93 column 5
offset2 = 1.5909
scale2 = 0.045455
#+end_example

* Feed Forward
** Real Tanks
|  V |  h_1 | h_2 |
|  5 |  5.5 |  11 |
|  7 |    9 |  18 |
| 10 | 14.5 |  28 |

At 7 volts we get zero steady state error with a feed forward term of 0.3888, which gives a tank 2 height of 18cm.

From the data above the following piece wise function can be obtained which provides the system with the required voltage for a input height.
\begin{cases}
V = 0.022h           & 0 < h < 0.11 \\
V = 0.035h - 0.065   & 0.11 < h < 0.18 \\
V = -0.01429h + 0.28 & 0.18 < h < \infty
\end{cases}
This was tested on the real tanks and in simulation, the simulation has a larger error than in real life

** Non-Linear
We want an equation that is $\frac{V_p(t)}{h_2(t)} = f(h_2)$
\begin{align*}
K_{pump}V_p(t) &= \frac{\pi}{4} D_2^2 \frac{dh_2(t)}{dt} + \frac{\pi}{4}D_{o2}^2C_d\sqrt{2gh_2(t)} \\
\textrm{With } \frac{dh_2(t)}{dt} &= 0 \\
K_{pump} V_p &= \frac{\pi C_{d} D_{o2} \sqrt{2g h_{2}}}{4} \\
\Rightarrow \frac{V_p(t)}{h_2(t)} &= \frac{\pi C_{d} D_{o2} \sqrt{2g h_{2}}}{4 K_{pump} h_{2}} \\
\Rightarrow \frac{V_p(t)}{h_2(t)} &= \frac{695.77}{\sqrt{h_2}}
\end{align*}

#+BEGIN_SRC octave :exports code :results output :session Q1
clc
clear
close all

if exist('OCTAVE_VERSION', 'builtin')
  set(0, "DefaultLineLineWidth", 2);
  set(0, "DefaultAxesFontSize", 25);
  warning('off');
  pkg load symbolic
end

syms D_2 D_o2 g K_pump V_p C_d t h_2 d_h_2

equ1 = pi/4*D_2*d_h_2 + pi/4*D_o2*C_d*sqrt(2*g*h_2) == K_pump*V_p;
equ2 = subs(equ1, d_h_2, 0);
latex(equ2)
equ3 = solve(equ2, V_p);
equ4 = simplify(equ3/h_2);
latex(equ4)

val_K_pump = 2e-5;
val_D_o1 = 5e-3;
val_D_o2 = 5e-3;
val_D_2 = 4e-2;
val_C_d = 0.8;
val_g = 9.81;
equ5 = subs(equ4, K_pump, val_K_pump)
equ5 = subs(equ5, D_o1, val_D_o1);
equ5 = subs(equ5, D_o2, val_D_o2);
equ5 = subs(equ5, D_2, val_D_2);
equ5 = subs(equ5, C_d, val_C_d);
equ5 = subs(equ5, g, val_g);
latex(vpa(equ5))
#+END_SRC

#+RESULTS:
#+begin_example
\frac{\sqrt{2} \pi C_{d} D_{o2} \sqrt{g h_{2}}}{4} = K_{pump} V_{p}
\frac{\sqrt{2} \pi C_{d} D_{o2} \sqrt{g h_{2}}}{4 K_{pump} h_{2}}
equ5 = (sym)

                       ______
  12500⋅√2⋅π⋅C_d⋅Dₒ₂⋅╲╱ g⋅h₂ 
  ───────────────────────────
              h₂
error: 'D_o1' undefined near line 1, column 19
\frac{695.77589486373630782025294921827}{h_{2}^{0.5}}
#+end_example
** Linear

* Disturbance
Tank 1 steady state = 7.5cm (h_1) : t = 12.19s, h = 20cm
\[Vol = 0.000318\]
\[q_1 = \frac{0.000318}{12.19} = 2.6086e-5\]

Tank 1 + disturbance steady state (h_1') = 5cm : t = 5.93, h_2 = 11->20cm
\[Vol = pi*(4.5e-2/2)^2 (20-11)*10^-2 = 0.000143138 \]
\[q_2 = 0.000143138/t = 0.00002413808015\]

\[q_{BYP} = q_1 - q_2\]
\[q_{BYP} = 0.00000194791985\]

\[q_{BYP} = C_dCA_o\sqrt{2gh_1^{'}}\]
\[C_d\cdot A_o = \frac{q_{BYP}}{\sqrt{2gh_1^{'}}}\]
\[C_d\cdot A_o = \frac{0.00000194791985}{\sqrt{2*9.81*5e-2}}\]
\[\alpha_{BYP} = C_d\cdot A_o = 0.000\ 001\ 966\ 693\ 034\]
\[q_{BYP} = \alpha_{BYP}\sqrt{2gh}\]

* Noise
|  V | h_1 (cm) | h_2 (cm) |
|  5 |        5 |       10 |
|  7 |        8 |       16 |
| 10 |       13 |       26 |

* Part 2 & Controller Design & Evaluation

** Cascade Compensator

** Feedback Compensator

** Nested Control
