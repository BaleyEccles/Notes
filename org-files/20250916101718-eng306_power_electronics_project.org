:PROPERTIES:
:ID:       e7306f88-f756-4210-87c5-e53bc24315bb
:END:
#+title: ENG306 - Power Electronics - Project
#+date: [2025-09-16 Tue 10:17]
#+AUTHOR: Baley Eccles - 652137
#+STARTUP: latexpreview

* ENG306 - Power Electronics - Project

** Stage 1 - Full-Wave Rectifier
 - Input of 32V (rms) gives 43.43V
 - Input of 20V (rms) gives 26.46V

   R= 43/5

** Stage 2 - Synchronous Buck Controller
\[L = \frac{V_{in} - V_O}{\Delta I_L f_{SW}}D_{ON}\]
\[47\mu = \frac{43.43 - 12}{0.1\times 100k}D\]
\[D = \frac{47\mu\times0.1\times 100k}{5 - 0.5}\]

Max Load = 12/5 = 2.4
Min Load = 12/0.5 = 24


Kp = 0.01 and Ki = 10
** Week 10 Workshop Stuff
Added
 - inductor L1 = 47uH
 - three 3.3uF caps (C10, C11, C14)
 - two 22uF caps (C16, C17)
Recorded with any DC input voltage
 - Output gives 10.5V

Datasheet: https://www.ti.com/lit/ds/symlink/lm5117.pdf, might be good for inductor calculations

** Design
From Datasheet: https://www.ti.com/lit/ds/symlink/lm5117.pdf
\[R_{b8} || 22k = \frac{5.2\times10^9}{f_{SW}} - 948\]
if $R_{b8} = 0$ then $f_{SW} = 226\ 600\ Hz$
\[L = 47\mu = \frac{V_{out}}{I_{\max}f_{SW}}\left(1 - \frac{V_{out}}{V_{in,\max}}\right)\]
\[L = 47\mu = \frac{12}{5\times f_{SW}}\left(1 - \frac{12}{V_{in,\max}}\right)\]

\[I_{\max} = \frac{V_{out}}{L f_{SW}}\left(1 - \frac{V_{out}}{V_{in}}\right)\]
\[I_{\max} = \frac{12}{47\mu f_{SW}}\left(1 - \frac{12}{20}\right)\]


\[V_{in,\max} = \frac{\Delta V_{rectifier,out}}{2} + V_{rectifier,out}\]
\[V_{in,\max} = \frac{\Delta V_{rectifier,out}}{2} + 20\]

-------------------------------------
$V_{out} = 12$
$I_{out} = 5$
$V_{in,\min} = 20$
$V_{in,\max} = 32$
$f_{SW} = 230\ kHz$

\[R_{T} = \frac{5.2\times 10^9}{230\times^10^3} - 948 = 21.7k \approx 22k\]
\[L = \frac{V_{out}}{I_{\max}f_{SW}}\left(1 - \frac{V_{out}}{V_{in,\max}}\right)\]
\[L = \frac{12}{9\cdot230\times10^3}\left(1 - \frac{12}{32}\right) = 6.522\mu\]

\[I_{\max} = \frac{V_{out}}{L\cdot f_{SW}}\left(1 - \frac{V_{out}}{V_{in,\max}}\right)\]
\[5 = \frac{12}{L\times 10^{-6}\cdot 230\times10^3}\left(1 - \frac{12}{32}\right)\]
\[\Rightarrow L < 16\]


#+BEGIN_SRC octave :exports none :results output :session Q1
clc
clear
close all

if exist('OCTAVE_VERSION', 'builtin')
  set(0, "DefaultLineLineWidth", 2);
  set(0, "DefaultAxesFontSize", 25);
  warning('off');
  pkg load symbolic
end

syms R_freq I_pp I_avg f_sw Delta_V_in C_in V_in real

% Known Varibles
L = 47e-6;
R_T = 22e3;
V_out = 12;


I_max = 5;
I_min = 0.5;
Delta_V_out = 0.007*V_out;

R_ESR = 300e-3; % This can be found in the data sheet for C_out. I dont know which datasheet to look at, I have assumed worst case
C_15 = 470e-6;
C_16 = 22e-6;
C_17 = 22e-6;
C_out = C_15 + C_16 + C_17;


% Equations
equ1 = 1/(1/R_T + 1/R_freq) == 5.2e9/f_sw - 948;
equ1 = simplify(equ1);

equ2 = I_max == V_out/(L*f_sw)*(1 - V_out/V_in);
equ2 = simplify(equ2);

equ3 = I_pp == V_out/(L*f_sw)*(1 - V_out/V_in);
equ3 = simplify(equ3);

equ4 = I_max == I_avg + I_pp/2;
equ4 = simplify(equ4);

equ5 = Delta_V_out == I_pp*sqrt(R_ESR^2 + (1/(8*f_sw*C_out))^2);
equ5 = simplify(equ5);

equ6 = Delta_V_in == I_max/(4*f_sw*C_in);
equ6 = simplify(equ6);

equ1
equ2
equ3
equ4
equ5
equ6

solutions = solve([equ1, equ2, equ3, equ4, equ5, equ6], [R_freq, I_pp, I_avg, f_sw, Delta_V_in, C_in, V_in])

% Display the results
%sol = solutions(1){1}
sol = solutions;
double(abs(sol.C_in))
double(abs(sol.I_avg))
double(abs(sol.I_pp))
double(abs(sol.R_freq))
double(abs(sol.f_sw))

#+END_SRC

#+RESULTS:
#+begin_example
equ1 = (sym)

        5200000000         
  948 - ────────── = -22000
           f_sw
equ2 = (sym)

  1276596⋅(Vᵢₙ - 12)    
  ────────────────── = 5
      5⋅Vᵢₙ⋅f_sw
equ3 = (sym)

        1276596⋅(Vᵢₙ - 12)
  Iₚₚ = ──────────────────
            5⋅Vᵢₙ⋅f_sw
equ4 = (sym) 2⋅I_avg + Iₚₚ = 10
equ5 = (sym)

         _______________________________      
        ╱        2     2                      
  Iₚₚ⋅╲╱  63504⋅π ⋅f_sw  + 411862315225    21 
  ────────────────────────────────────── = ───
               840⋅π⋅│f_sw│                250
equ6 = (sym)

               5     
  Δ_V_in = ──────────
           4⋅Cᵢₙ⋅f_sw
solutions = {}(0x0)
error: cell cannot be indexed with .
error: cell cannot be indexed with .
error: cell cannot be indexed with .
error: cell cannot be indexed with .
error: cell cannot be indexed with .
#+end_example

** Rectifier Output Filter
Do as many LC stages with $470\mu F$ caps and $47\mu H$ inductors as possible.

** Fix 12V output
Change R18, R17, R16 and  Rb16.
 - See 8.3.21 in datasheet for calculations
\[\frac{R_{FB2}}{R_{FB1}} = \frac{V_{out}}{0.8} - 1\]
\[\frac{R_{FB2}}{R_{FB1}} = \frac{12}{0.8} - 1 = 14\]

In our circuit
\[R_{FB2} = 22 + 4700 = 4722\]
\[R_{FB1} = 470 || 2200 = 387.27\]

\[\frac{R_{FB2}}{R_{FB1}} = \frac{4722}{387.27} = 12.183\]
Solving $12.183 = \frac{V_{out}}{0.8} - 1$ we get $V_{out} = 10.554$, which is what we were seeing on the output.

We should remove R16 and replace it with the following
\[\frac{4722}{R_{FB1}} = \frac{12}{0.8} - 1\]
\[R_{FB1} = \frac{4722}{\frac{12}{0.8} - 1} = 337.285\]

\[R_{FB1} = R16 || 2200 = 337.285\]
\[337.285 = 1/(1/R16 + 1/2200)\]
\[\Rightarrow R16 = 398.358 769\Omega \]

\[R16 \approx 400\Omega\]
If we choose this, then:
\[\frac{R_{FB2}}{R_{FB1}} = \frac{4722}{400 || 2200} = \frac{V_{out}}{0.8} - 1\]
\[\Rightarrow V_{out} = 11.961\]

This may be good enough, by if it doesnt we can remove Rb16 too and choose:

#+BEGIN_SRC octave :exports none :results output :session Feedback
clc;
clear;
close all;

V_out = 12;

R_FB2 = 22 + 4700;

R_FB1 = R_FB2/(V_out/0.8 - 1);

% Add actual avalible resistors to R_vals
R_vals = [0, 1e3, 10e3, 1, 1.2, 1.5, 2, 2.7, 3.3, 4.3, 5.1, 6.8, 8.2, 10, 12, 15, 20, 27, 33, 43, 51, 68, 82, 100, 120, 150, 200, 270, 330, 430, 510, 680, 820, 1.2e3, 1.5e3, 2e3, 2.7e3, 3.3e3, 4.3e3, 5.1e3, 6.8e3, 8.2e3, 12e3, 15e3, 20e3, 27e3, 33e3, 43e3, 51e3, 68e3, 82e3, 100e3, 120e3, 150e3, 200e3, 270e3, 330e3, 430e3, 510e3, 680e3, 820e3, 1e6, 2e6];

R16 = R_vals;

Rb16 = 1./(1./R_FB1 - 1./R16);

% May need to change tolerance
tol = 5/100; % Tolerance of 5%

for idx = 1:length(R16)
  for jdx = 1:length(R_vals)
    up_bound = R_vals(jdx) + R_vals(jdx)*tol;
    low_bound = R_vals(jdx) - R_vals(jdx)*tol;
    if (Rb16(idx) >= low_bound && Rb16(idx) <= up_bound)
      percent_error = 100*abs(R_vals(jdx) - Rb16(idx))/Rb16(idx);
      sprintf("For an error of %f choose:", percent_error)
      sprintf("R16 = %f and ideally Rb16 = %f, but select Rb16 = %f from the resistor book.", R16(idx), Rb16(idx), R_vals(jdx))
      
    end
  end
end

#+END_SRC

#+RESULTS:
#+begin_example
ans = For an error of NaN choose:
ans = R16 = 0.000000 and ideally Rb16 = -0.000000, but select Rb16 = 0.000000 from the resistor book.
ans = For an error of 0.207116 choose:
ans = R16 = 1000.000000 and ideally Rb16 = 508.945894, but select Rb16 = 510.000000 from the resistor book.
ans = For an error of 4.110399 choose:
ans = R16 = 430.000000 and ideally Rb16 = 1564.298921, but select Rb16 = 1500.000000 from the resistor book.
ans = For an error of 0.406109 choose:
ans = R16 = 510.000000 and ideally Rb16 = 995.955335, but select Rb16 = 1000.000000 from the resistor book.
ans = For an error of 1.609488 choose:
ans = R16 = 680.000000 and ideally Rb16 = 669.228845, but select Rb16 = 680.000000 from the resistor book.
ans = For an error of 1.178314 choose:
ans = R16 = 1500.000000 and ideally Rb16 = 435.127165, but select Rb16 = 430.000000 from the resistor book.
ans = For an error of 4.360102 choose:
ans = R16 = 15000.000000 and ideally Rb16 = 345.044281, but select Rb16 = 330.000000 from the resistor book.
ans = For an error of 3.810102 choose:
ans = R16 = 20000.000000 and ideally Rb16 = 343.071368, but select Rb16 = 330.000000 from the resistor book.
ans = For an error of 3.382324 choose:
ans = R16 = 27000.000000 and ideally Rb16 = 341.552409, but select Rb16 = 330.000000 from the resistor book.
ans = For an error of 3.160102 choose:
ans = R16 = 33000.000000 and ideally Rb16 = 340.768635, but select Rb16 = 330.000000 from the resistor book.
ans = For an error of 2.927544 choose:
ans = R16 = 43000.000000 and ideally Rb16 = 339.952250, but select Rb16 = 330.000000 from the resistor book.
ans = For an error of 2.807160 choose:
ans = R16 = 51000.000000 and ideally Rb16 = 339.531185, but select Rb16 = 330.000000 from the resistor book.
ans = For an error of 2.645396 choose:
ans = R16 = 68000.000000 and ideally Rb16 = 338.967019, but select Rb16 = 330.000000 from the resistor book.
ans = For an error of 2.562541 choose:
ans = R16 = 82000.000000 and ideally Rb16 = 338.678782, but select Rb16 = 330.000000 from the resistor book.
ans = For an error of 2.490102 choose:
ans = R16 = 100000.000000 and ideally Rb16 = 338.427181, but select Rb16 = 330.000000 from the resistor book.
ans = For an error of 2.435102 choose:
ans = R16 = 120000.000000 and ideally Rb16 = 338.236400, but select Rb16 = 330.000000 from the resistor book.
ans = For an error of 2.380102 choose:
ans = R16 = 150000.000000 and ideally Rb16 = 338.045834, but select Rb16 = 330.000000 from the resistor book.
ans = For an error of 2.325102 choose:
ans = R16 = 200000.000000 and ideally Rb16 = 337.855483, but select Rb16 = 330.000000 from the resistor book.
ans = For an error of 2.282324 choose:
ans = R16 = 270000.000000 and ideally Rb16 = 337.707581, but select Rb16 = 330.000000 from the resistor book.
ans = For an error of 2.260102 choose:
ans = R16 = 330000.000000 and ideally Rb16 = 337.630799, but select Rb16 = 330.000000 from the resistor book.
ans = For an error of 2.236846 choose:
ans = R16 = 430000.000000 and ideally Rb16 = 337.550484, but select Rb16 = 330.000000 from the resistor book.
ans = For an error of 2.224808 choose:
ans = R16 = 510000.000000 and ideally Rb16 = 337.508924, but select Rb16 = 330.000000 from the resistor book.
ans = For an error of 2.208631 choose:
ans = R16 = 680000.000000 and ideally Rb16 = 337.453094, but select Rb16 = 330.000000 from the resistor book.
ans = For an error of 2.200346 choose:
ans = R16 = 820000.000000 and ideally Rb16 = 337.424505, but select Rb16 = 330.000000 from the resistor book.
ans = For an error of 2.193102 choose:
ans = R16 = 1000000.000000 and ideally Rb16 = 337.399514, but select Rb16 = 330.000000 from the resistor book.
ans = For an error of 2.176602 choose:
ans = R16 = 2000000.000000 and ideally Rb16 = 337.342605, but select Rb16 = 330.000000 from the resistor book.
#+end_example


